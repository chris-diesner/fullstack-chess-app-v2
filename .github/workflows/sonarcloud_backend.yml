name: SonarCloud Analysis

on: [push, pull_request]

jobs:
  sonarcloud:
    runs-on: ubuntu-latest
    steps:
      - name: üõéÔ∏è Checkout Repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # Deaktiviert shallow clone f√ºr vollst√§ndige Git-Historie

      - name: üì• Install SonarScanner
        run: |
          SONAR_SCANNER_VERSION=5.0.1.3006
          curl -Lo sonarscanner.zip https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-${SONAR_SCANNER_VERSION}-linux.zip
          unzip sonarscanner.zip
          sudo mv sonar-scanner-${SONAR_SCANNER_VERSION}-linux /opt/sonar-scanner
          echo "PATH=/opt/sonar-scanner/bin:$PATH" >> $GITHUB_ENV

      - name: üîç SonarCloud Scan
        run: |
          sonar-scanner \
            -Dsonar.host.url=https://sonarcloud.io \
            -Dsonar.projectKey=chris-diesner_fullstack-chess-app-v2-backend \
            -Dsonar.organization=chris-diesner \
            -Dsonar.projectBaseDir=backend
            -Dsonar.python.version=3.10
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
